/*! block.js 19-12-2014 */
!function(a){"use strict";var b={},c=0;if(a.BLOCK)return void alert("init failed");a.BLOCK=b;var d=function(a){var b=document.getElementById(a.canvas);b.setAttribute("width",a.canvas_width),b.setAttribute("height",a.canvas_height);var c=b.getContext("2d");if(c){var d=new f(b,c,a);return d.init(),d}return!1},e=function(a,b,d,e){this.width=a,this.height=b,this.color=d,this.location=e;var f=this;this.check_click=function(a){var b=a.clientX,d=a.clientY,e=this.location.x+this.width,f=this.location.y+this.height;b>this.location.x&&e>b&&d>this.location.y&&f>d&&("#000000"===this.color&&(c+=1),this.color="#ffffff",console.log("score:"+c))},this.set_color=function(a){f.color=a},this.set_location=function(a){f.location=a}},f=function(a,b,c){this.canvas=a,this.context=b,this.config=c,this.block_buffer=[];var d=this.config.canvas_width/this.config.row,f=this.config.canvas_height/this.config.col,g=(this.config.row*this.config.col,this);this.canvas.onclick=function(a){for(var b=(a.clientX,a.clientY,0);b<g.block_buffer.length;b++)for(var c=0;c<g.block_buffer[b].length;c++){var d=g.block_buffer[b][c];d.check_click(a)}};var h=function(a,b,c,f){for(var h=[],i=0;i<g.config.level;i++){for(var j=[],k="#000000",l=0;f>l;l++){var m=parseInt(100*Math.random())%3;m>1&&(k="#ffffff");var n=new e(d,b,k,{x:l*d,y:i*b});j.push(n)}h.push(j)}return h},i=function(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++){var e=b[c][d];a.fillStyle=e.color,a.fillRect(e.location.x,e.location.y,e.width,e.height)}},j=function(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++){var e=b[c][d];e.location.y-=1}},k=function(a,b,c){var d=function(){a.clearRect(0,0,b.canvas_width,b.canvas_height),j(a,c),i(a,c)};setInterval(d,1e3/60)};this.init=function(){this.block_buffer=h(d,f,this.config.row,this.config.col),i(this.context,this.block_buffer),k(this.context,this.config,this.block_buffer)}};b.init=function(a){return a.canvas&&a.canvas_width&&a.canvas_height?d(a):void 0}}(window);